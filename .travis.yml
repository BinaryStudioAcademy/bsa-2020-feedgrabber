language: java
jdk:
    - openjdk11
addons:
  ssh_known_hosts: 
    - 23.97.183.10

env:
    - NODE_VERSION="v12.18.0"
      
before_install:
    - nvm install $NODE_VERSION
    - node --version
    - npm --version

before_cache:
    - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
    - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
      
cache:
    directories:
        - $HOME/.gradle/caches/
        - $HOME/.gradle/wrapper/
    npm: true

script:
    - if [[ $TRAVIS_EVENT_TYPE == "pull_request" && ($TRAVIS_PULL_REQUEST_BRANCH == "dev") || $TRAVIS_BRANCH == "infrastructure/ci_cd" ]] ; then bash scripts/test.sh ; fi
    - if [[ $TRAVIS_EVENT_TYPE == "push" && $TRAVIS_BRANCH == "dev" ]] ; then  bash scripts/build.sh && bash scripts/deploy.sh ; fi
